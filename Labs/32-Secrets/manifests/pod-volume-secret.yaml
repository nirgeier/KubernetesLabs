---
apiVersion: v1
kind: Pod
metadata:
  name: secret-volume-demo
  namespace: secrets-lab
  labels:
    app: secret-volume-demo
    lab: "34"
spec:
  containers:
    - name: demo
      image: busybox:1.36
      command:
        - sh
        - -c
        - |
          echo "=== Secret files mounted as volume ==="
          echo "--- Listing /etc/secrets ---"
          ls -la /etc/secrets/
          echo ""
          echo "--- Contents of each file ---"
          for f in /etc/secrets/*; do
            echo "$f: $(cat $f)"
          done
          echo ""
          echo "=== Sleeping to keep pod alive for inspection ==="
          sleep 3600
      volumeMounts:
        # Mount the entire Secret as a directory
        - name: secret-volume
          mountPath: /etc/secrets
          readOnly: true
  volumes:
    # Reference the Secret to be projected as files
    - name: secret-volume
      secret:
        secretName: app-credentials
        # Optional: set file permissions (default is 0644)
        defaultMode: 0400
  restartPolicy: Never
