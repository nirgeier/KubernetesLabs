---
apiVersion: v1
kind: Pod
metadata:
  name: secret-env-demo
  namespace: secrets-lab
  labels:
    app: secret-env-demo
    lab: "34"
spec:
  containers:
    - name: demo
      image: busybox:1.36
      command:
        - sh
        - -c
        - |
          echo "=== Secret values loaded as environment variables ==="
          echo "DB_USERNAME=$DB_USERNAME"
          echo "DB_PASSWORD=$DB_PASSWORD"
          echo "DATABASE_URL=$DATABASE_URL"
          echo "=== Sleeping to keep pod alive for inspection ==="
          sleep 3600
      # Mount individual keys from the Secret as environment variables
      env:
        - name: DB_USERNAME
          valueFrom:
            secretKeyRef:
              name: app-credentials
              key: username
        - name: DB_PASSWORD
          valueFrom:
            secretKeyRef:
              name: app-credentials
              key: password
        - name: DATABASE_URL
          valueFrom:
            secretKeyRef:
              name: app-credentials
              key: database-url
  restartPolicy: Never
